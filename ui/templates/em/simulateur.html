{% extends "em/_base.html" %}

{% block head %}
    <title>{{ _('Simulateur de Grille EuroMillions - Analysez Votre Sélection | LotoIA') }}</title>
    <meta name="description" content="{{ _('Composez votre grille EuroMillions (5 numéros + 2 étoiles) et obtenez une analyse statistique. Équilibre, numéros chauds et froids, indice de convergence.') }}">
    <meta name="keywords" content="{{ _('simulateur euromillions, analyser grille euromillions, moteur HYBRIDE, analyse statistique, numéros chauds froids, HYBRIDE, étoiles euromillions') }}">
    <link rel="canonical" href="{{ canonical_url }}">
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="LotoIA">
    <meta property="og:locale" content="{{ og_locale }}">
    <meta property="og:title" content="{{ _('Simulateur de Grille EuroMillions | LotoIA') }}">
    <meta property="og:description" content="{{ _('Composez votre grille EuroMillions et obtenez une analyse statistique. Score et équilibre.') }}">
    <meta property="og:url" content="{{ canonical_url }}">
    <meta property="og:image" content="{{ base_url }}/static/og-image.jpg">
    <meta property="og:image:secure_url" content="{{ base_url }}/static/og-image.jpg">
    <meta property="og:image:type" content="image/jpeg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ _('Simulateur de Grille EuroMillions | LotoIA') }}">
    <meta name="twitter:description" content="{{ _('Composez votre grille EuroMillions et obtenez une analyse statistique.') }}">
    <meta name="twitter:image" content="{{ base_url }}/static/og-image.jpg">
    <!-- JSON-LD Schema.org -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": {{ _('LotoIA - Analyse statistique EuroMillions')|tojson }},
      "url": {{ canonical_url|tojson }},
      "description": {{ _('Outil d analyse statistique descriptive pour grilles EuroMillions')|tojson }},
      "applicationCategory": "StatisticalTool",
      "operatingSystem": "Web"
    }
    </script>
{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="/ui/static/simulateur.css?v=1">
    <link rel="stylesheet" href="/ui/static/em/sponsor-popup-em.css?v=4">
{% endblock %}

{% block body %}
    {% include "em/_hero.html" %}

    <div class="simulator-container">

        <!-- Colour legend -->
        <section id="grid-start" class="card legend-section">
            <div class="legend">
                <div class="legend-item">
                    <span class="legend-dot hot"></span>
                    <span>{{ _('Chaud (fréquent)') }}</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot neutral"></span>
                    <span>{{ _('Neutre') }}</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot cold"></span>
                    <span>{{ _('Froid (rare)') }}</span>
                </div>
            </div>
            <img src="/static/Hybride-audit.png" class="band-hybride" alt="{{ _('Bandeau moteur HYBRIDE') }}">
            <p id="stats-tirages" class="stats-info" style="text-align: center; margin-top: 12px; font-size: 0.9rem; color: var(--text-muted);">
                {{ _('Chargement des statistiques...') }}
            </p>
        </section>

        <!-- Unified simulation panel -->
        <div class="simulation-panel">
            <div class="simulation-workspace">
                <div class="workspace-left grid-section">
                    <h3 class="grid-title">{{ _('Numéros') }} <span id="count-main" class="count-badge">0/5</span></h3>
                    <div id="main-grid" class="main-grid">
                        <!-- Generated by JS (1-50) -->
                    </div>
                </div>

                <div class="workspace-right chance-section">
                    <div class="workspace-right-block">
                        <h3 class="grid-title-chance">{{ _('Étoiles') }} <span id="count-star" class="count-badge">0/2</span></h3>
                        <div id="star-grid" class="chance-grid">
                            <!-- Generated by JS (1-12) -->
                        </div>
                    </div>
                    <div class="workspace-right-block">
                        <div class="chance-actions">
                            <button id="btn-reset" class="btn btn-tertiary">
                                {{ _('Réinitialiser') }}
                            </button>
                            <button id="btn-auto" class="btn btn-primary">
                                {{ _('Remplir aléatoirement') }}
                            </button>
                        </div>
                    </div>
                    <div class="hybride-horizontal">
                        <img src="/static/Hybride-audit-horizontal.png" alt="{{ _('Assistant Hybride analyse de grille') }}">
                    </div>
                </div>
            </div>
        </div>

        <!-- Results -->
        <section id="results-section" class="card results-section" style="display: none;">
            <h2>{{ _('Analyse de votre grille') }}</h2>

            <!-- Convergence indicator (descriptive, non-evaluative) -->
            <div class="score-display">
                <div class="convergence-display">
                    <span class="convergence-display-label">{{ _('Indice de convergence statistique') }}</span>
                    <span id="convergence-level" class="convergence-display-value">--</span>
                </div>
                <p id="comparaison-text" class="comparaison-text"></p>
            </div>

            <!-- Badges -->
            <div id="badges-container" class="badges-container"></div>

            <!-- Details -->
            <div class="details-section">
                <h3>{{ _('Détails') }}</h3>
                <div id="details-grid" class="details-grid"></div>
            </div>

            <!-- Suggestions -->
            <div class="suggestions-section">
                <h3>{{ _('Suggestions') }}</h3>
                <ul id="suggestions-list" class="suggestions-list"></ul>
            </div>

            <!-- Selected grid -->
            <div class="selected-grid-display">
                <h3>{{ _('Votre grille') }}</h3>
                <div id="selected-numbers" class="selected-numbers"></div>
                <!-- Combination history -->
                <div id="history-check" class="history-line" style="display:none; margin-top:12px; font-size:14px; color:#9ca3af; text-align:center; line-height:1.6;"></div>
            </div>
        </section>

        <!-- Loading -->
        <div id="loading-overlay" class="loading-overlay" style="display: none;">
            <div class="loading-spinner"></div>
            <p>{{ _('Analyse en cours...') }}</p>
        </div>

        {% include "em/_footer.html" %}
    </div>
{% endblock %}

{% block page_scripts %}
    <script src="{{ sponsor_js }}"></script>
    <script src="{{ simulateur_js }}"></script>
{% endblock %}
